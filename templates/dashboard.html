<!DOCTYPE html>
<html>
<head>
    <title>Smart Crop IoT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header class="main-header">
    <h1>ğŸŒ± Smart Crop IoT Dashboard</h1>

    <select id="languageSwitcher" onchange="changeLanguage(this.value)">
        <option value="en">English</option>
        <option value="hi">Hindi</option>
        <option value="te">à°¤à±†à°²à±à°—à±</option>
    </select>
</header>

<section class="section-title">
    <h2 data-key="live_status">ğŸ“¡ Live Field Status</h2>
</section>

<section class="cards">
    <div class="card">
        <h3 data-key="moisture">Moisture</h3>
        <p id="moistureValue">--</p>
    </div>

    <div class="card">
        <h3 data-key="temperature">Temperature</h3>
        <p id="temperatureValue">--</p>
    </div>

    <div class="card">
        <h3 data-key="humidity">Humidity</h3>
        <p id="humidityValue">--</p>
    </div>
</section>

<section class="section-title">
    <h2 data-key="crop_rec">ğŸŒ¾ Crop Recommendation</h2>
</section>

<section class="recommendation">
    <p><strong data-key="soil">Soil Condition:</strong>
        <span id="soil">--</span>
    </p>

    <p><strong data-key="crop">Recommended Crop:</strong>
        <span id="crop">--</span>
    </p>

    <p><strong data-key="fertilizer">Fertilizer:</strong>
        <span id="fertilizer">--</span>
    </p>

    <div style="margin-top:20px;">
        <button onclick="speakRecommendation()">ğŸ”Š Hear Recommendation</button>
    </div>
</section>

<section class="section-title">
    <h2 data-key="yield">ğŸ“ˆ Yield Prediction</h2>
</section>

<section class="yield-section">
    <label data-key="land">Enter Land (in acres):</label>

    <div class="yield-input">
        <input type="number" id="landInput" placeholder="e.g. 2" min="0" step="0.1">
        <button onclick="predictYield()" data-key="predict">Predict</button>
    </div>

    <div class="yield-result">
        <h3 id="yieldResult"></h3>
    </div>
</section>

<section class="section-title">
    <h2>ğŸ“Š Moisture Trend</h2>
</section>

<section class="chart-section">
    <canvas id="sensorChart"></canvas>
</section>

<script>
function speakRecommendation() {

    const crop = document.getElementById("crop").innerText;
    const fertilizer = document.getElementById("fertilizer").innerText;
    const soil = document.getElementById("soil").innerText;
    const selectedLang = document.getElementById("languageSwitcher").value;

    if (crop === "--") {
        alert("Recommendation not available yet.");
        return;
    }

    let message = "";

    if (selectedLang === "te") {
        message = `à°¸à°¿à°«à°¾à°°à°¸à± à°šà±‡à°¸à°¿à°¨ à°ªà°‚à°Ÿ ${crop}. à°¨à±‡à°² à°ªà°°à°¿à°¸à±à°¥à°¿à°¤à°¿ ${soil}. à°à°°à±à°µà± ${fertilizer} à°µà°¾à°¡à°‚à°¡à°¿.`;
    }
    else if (selectedLang === "hi") {
        message = `à¤…à¤¨à¥à¤¶à¤‚à¤¸à¤¿à¤¤ à¤«à¤¸à¤² ${crop} à¤¹à¥ˆà¥¤ à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€ à¤•à¥€ à¤¸à¥à¤¥à¤¿à¤¤à¤¿ ${soil} à¤¹à¥ˆà¥¤ à¤‰à¤°à¥à¤µà¤°à¤• ${fertilizer} à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¥‡à¤‚à¥¤`;
    }
    else {
        message = `Recommended crop is ${crop}. Soil condition is ${soil}. Use fertilizer ${fertilizer}.`;
    }

    const speech = new SpeechSynthesisUtterance(message);

    const voices = window.speechSynthesis.getVoices();
    let selectedVoice = null;

    if (selectedLang === "te") {
        selectedVoice = voices.find(v => v.lang.includes("te"));
    }
    else if (selectedLang === "hi") {
        selectedVoice = voices.find(v => v.lang.includes("hi"));
    }
    else {
        selectedVoice = voices.find(v => v.lang.includes("en"));
    }

    if (selectedVoice) {
        speech.voice = selectedVoice;
    }

    speech.rate = 0.9;
    speech.pitch = 1;

    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(speech);
}
</script>

<!-- LOAD SCRIPTS ONLY ONCE -->
<script src="{{ url_for('static', filename='translations.js') }}"></script>
<script src="{{ url_for('static', filename='dashboard.js') }}"></script>

</body>
</html>