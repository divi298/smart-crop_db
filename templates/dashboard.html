<!DOCTYPE html>
<html>
<head>
    <title>Smart Crop IoT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='translations.js') }}"></script>
</head>
<body>

<header class="main-header">
    <h1>üå± Smart Crop IoT Dashboard</h1>

    <select id="languageSwitcher" onchange="changeLanguage(this.value)">
    <option value="en">English</option>
    <option value="hi">Hindi</option>
    <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
</select>
</header>

<!-- ========================= -->
<!-- üå° LIVE SENSOR STATUS -->
<!-- ========================= -->
<section class="section-title">
    <h2 data-key="live_status">üì° Live Field Status</h2>
</section>

<section class="cards">
    <div class="card">
        <h3 data-key="moisture">Moisture</h3>
        <p id="moistureValue">--</p>
    </div>

    <div class="card">
        <h3 data-key="temperature">Temperature</h3>
        <p id="temperatureValue">--</p>
    </div>

    <div class="card">
        <h3 data-key="humidity">Humidity</h3>
        <p id="humidityValue">--</p>
    </div>
</section>

<!-- ========================= -->
<!-- üåæ CROP RECOMMENDATION -->
<!-- ========================= -->
<section class="section-title">
    <h2 data-key="crop_rec">üåæ Crop Recommendation</h2>
</section>

<section class="recommendation">
    <p><strong data-key="soil">Soil Condition:</strong>
        <span id="soil">--</span>
    </p>

    <p><strong data-key="crop">Recommended Crop:</strong>
        <span id="crop">--</span>
    </p>

    <p><strong data-key="fertilizer">Fertilizer:</strong>
        <span id="fertilizer">--</span>
    </p>

    <!-- üîä VOICE BUTTON -->
    <div style="margin-top:20px;">
        <button onclick="speakRecommendation()">üîä Hear Recommendation</button>
    </div>
</section>

<!-- ========================= -->
<!-- üåæ YIELD PREDICTION -->
<!-- ========================= -->
<section class="section-title">
    <h2 data-key="yield">üìà Yield Prediction</h2>
</section>

<section class="yield-section">
    <label data-key="land">Enter Land (in acres):</label>

    <div class="yield-input">
        <input type="number" id="landInput" placeholder="e.g. 2" min="0" step="0.1">
        <button onclick="predictYield()" data-key="predict">Predict</button>
    </div>

    <div class="yield-result">
        <h3 id="yieldResult"></h3>
    </div>
</section>

<!-- ========================= -->
<!-- üìä SENSOR TREND CHART -->
<!-- ========================= -->
<section class="section-title">
    <h2>üìä Moisture Trend</h2>
</section>

<section class="chart-section">
    <canvas id="sensorChart"></canvas>
</section>

<!-- ========================= -->
<!-- üéô VOICE SCRIPT -->
<!-- ========================= -->
<script>
function speakRecommendation() {

    const crop = document.getElementById("crop").innerText;
    const fertilizer = document.getElementById("fertilizer").innerText;
    const soil = document.getElementById("soil").innerText;
    const selectedLang = document.getElementById("languageSwitcher").value;

    if (crop === "--") {
        alert("Recommendation not available yet.");
        return;
    }

    let message = "";

    if (selectedLang === "te") {
        message = `‡∞∏‡∞ø‡∞´‡∞æ‡∞∞‡∞∏‡±Å ‡∞ö‡±á‡∞∏‡∞ø‡∞® ‡∞™‡∞Ç‡∞ü ${crop}. ‡∞®‡±á‡∞≤ ‡∞™‡∞∞‡∞ø‡∞∏‡±ç‡∞•‡∞ø‡∞§‡∞ø ${soil}. ‡∞é‡∞∞‡±Å‡∞µ‡±Å ${fertilizer} ‡∞µ‡∞æ‡∞°‡∞Ç‡∞°‡∞ø.`;
    }
    else if (selectedLang === "hi") {
        message = `‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§ ‡§´‡§∏‡§≤ ${crop} ‡§π‡•à‡•§ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ${soil} ‡§π‡•à‡•§ ‡§â‡§∞‡•ç‡§µ‡§∞‡§ï ${fertilizer} ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§`;
    }
    else {
        message = `Recommended crop is ${crop}. Soil condition is ${soil}. Use fertilizer ${fertilizer}.`;
    }

    const speech = new SpeechSynthesisUtterance(message);

    if (selectedLang === "te") speech.lang = "te-IN";
    else if (selectedLang === "hi") speech.lang = "hi-IN";
    else speech.lang = "en-IN";

    speech.rate = 0.9;
    speech.pitch = 1;

    window.speechSynthesis.cancel(); // stop previous speech
    window.speechSynthesis.speak(speech);
}
</script>

<script src="/static/translations.js"></script>
<script src="/static/dashboard.js"></script>

</body>
</html>